(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{118:function(e,t,a){e.exports=a(284)},124:function(e,t,a){},126:function(e,t,a){},127:function(e,t,a){},172:function(e,t){},176:function(e,t,a){},181:function(e,t,a){},182:function(e,t,a){},183:function(e,t,a){},184:function(e,t,a){},186:function(e,t,a){},187:function(e,t,a){},282:function(e,t,a){},283:function(e,t,a){},284:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(112),o=a.n(s);a(123),a(124),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i=a(2),c=a.n(i),l=a(9),u=a(10),p=a(12),d=a(14),v=a(13),m=(a(126),a(16)),h=a(15),f=(a(127),function e(t,a,r){Object(u.a)(this,e),this.followId=t,this.userName=a,this.vacationId=r}),g=a(69),E=a.n(g),b=function(){function e(){Object(u.a)(this,e)}return Object(p.a)(e,null,[{key:"_initialize",value:function(){e.serverUrl="https://itay-vacations.herokuapp.com"}}]),e}();b.serverUrl=void 0,b.captchaKey=void 0,b._initialize();var k,y=E.a.create({baseURL:b.serverUrl}),w=E.a.create({baseURL:b.serverUrl,headers:{"Content-Type":"application/json"},withCredentials:!0}),x=a(17),S=a.n(x),O=a(113),D=a(4);!function(e){e[e.SaveAllVacations=0]="SaveAllVacations",e[e.SaveAllFollows=1]="SaveAllFollows",e[e.saveAllPurchases=2]="saveAllPurchases",e[e.saveToken=3]="saveToken",e[e.saveUser=4]="saveUser",e[e.setFollowsPerVacation=5]="setFollowsPerVacation",e[e.sortVacations=6]="sortVacations",e[e.saveOneVacation=7]="saveOneVacation",e[e.addOneVacation=8]="addOneVacation",e[e.deleteOneVacation=9]="deleteOneVacation",e[e.AddFollow=10]="AddFollow",e[e.RemoveFollow=11]="RemoveFollow",e[e.addPurchase=12]="addPurchase"}(k||(k={}));var j=a(29),N=Object(O.a)((function(e,t){var a=Object(D.a)({},e);switch(t.type){case k.SaveAllFollows:a.follows=t.payload;break;case k.SaveAllVacations:a.vacations=t.payload;break;case k.saveToken:a.token=t.payload;break;case k.saveAllPurchases:a.purchases=t.payload;break;case k.saveUser:a.user=t.payload,a.isLoggedIn=!!t.payload;break;case k.saveOneVacation:for(var r in a.vacations)if(a.vacations[r].vacationId===t.payload.vacationId){var n=a.vacations[r].follows,s=a.vacations[r].isFollow;a.vacations[r]=t.payload,a.vacations[r].follows=n,a.vacations[r].isFollow=s}break;case k.addOneVacation:a.vacations.push(t.payload);break;case k.deleteOneVacation:a.vacations=a.vacations.filter((function(e){return e.vacationId!==t.payload}));break;case k.AddFollow:a.follows.push(t.payload);break;case k.RemoveFollow:a.follows=a.follows.filter((function(e){return e.followId!==t.payload}));break;case k.setFollowsPerVacation:var o=0;a.vacations.forEach((function(e){e.isFollow=!1,a.follows.forEach((function(t){t.vacationId===e.vacationId&&(o++,t.userName===a.user.userName&&(e.isFollow=!0))})),e.follows=o,o=0}));break;case k.sortVacations:var i=a.vacations.filter((function(e){return!0===e.isFollow})),c=a.vacations.filter((function(e){return!1===e.isFollow}));a.vacations=i.concat(c);break;case k.addPurchase:a.purchases.push(t.payload)}return a}),new function e(){Object(u.a)(this,e),this.vacations=void 0,this.follows=void 0,this.purchases=void 0,this.user=void 0,this.token=void 0,this.isLoggedIn=void 0;var t=new j.a;this.vacations=[],this.follows=[],this.purchases=[],this.user=t.get("user"),this.isLoggedIn=!!this.user,this.token=null}),I=a(11),C=a(22),F=a(48),A=a(285),T=(a(176),a(21));function L(e){return!!N.getState().isLoggedIn||("/"!==e.location.pathname&&alert("Error: You are not logged-in"),e.history.push("/login"),!1)}function P(e){var t;return!!(null===(t=N.getState().user)||void 0===t?void 0:t.isAdmin)||(alert("Error: You are not admin"),e.history.push("/"),!1)}function U(){return V.apply(this,arguments)}function V(){return(V=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,console.log("disconnect"),e.next=4,y.get("/api/auth/logout",{withCredentials:!0});case 4:(new j.a).remove("user"),N.dispatch({type:k.saveUser,payload:null}),N.dispatch({type:k.saveToken,payload:null}),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(0),alert(e.t0);case 13:case"end":return e.stop()}}),e,null,[[0,10]])})))).apply(this,arguments)}function M(e,t){return B.apply(this,arguments)}function B(){return(B=Object(l.a)(c.a.mark((function e(t,a){var r,n,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t){e.next=2;break}return e.abrupt("return");case 2:if("Error: Network Error"!==t){e.next=5;break}return alert(t),e.abrupt("return");case 5:if("You are not logged-in"!==(null===(r=t.response)||void 0===r?void 0:r.data)){e.next=11;break}return e.next=8,U();case 8:return alert("Error: You are not logged-in"),a.history.push("/login"),e.abrupt("return");case 11:if("Your login session has expired"!==(null===(n=t.response)||void 0===n?void 0:n.data)){e.next=17;break}return e.next=14,U();case 14:return alert("Error: Your login session has expired"),a.history.push("/login"),e.abrupt("return");case 17:if("You are not admin!"!==(null===(s=t.response)||void 0===s?void 0:s.data)){e.next=23;break}return e.next=20,U();case 20:return alert("Error: You are not admin!"),a.history.push("/login"),e.abrupt("return");case 23:if("Illegal username or password"!==(null===(o=t.response)||void 0===o?void 0:o.data)){e.next=26;break}return alert("Error: Illegal username or password"),e.abrupt("return");case 26:alert(null===(i=t.response)||void 0===i?void 0:i.data);case 27:case"end":return e.stop()}}),e)})))).apply(this,arguments)}var W=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).logOut=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,U();case 2:r.props.history.push("/login");case 3:case"end":return e.stop()}}),e)}))),r.state={user:N.getState().user},r}return Object(p.a)(a,[{key:"render",value:function(){var e,t;return n.a.createElement("div",{className:"nav-bar"},n.a.createElement("div",{className:"nav-container"},n.a.createElement("nav",null,(null===(e=this.state.user)||void 0===e?void 0:e.isAdmin)?n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(m.b,{to:"/",exact:!0},"Home")),n.a.createElement("li",null,n.a.createElement(m.b,{to:"/admin",exact:!0}," Edit Vacation ")),n.a.createElement("li",null,n.a.createElement(m.b,{to:"/admin/add",exact:!0}," Add Vacation")),n.a.createElement("li",null,n.a.createElement(m.b,{to:"/purchases",exact:!0}," Purchases")),n.a.createElement("li",null,n.a.createElement(m.b,{to:"/reports",exact:!0}," Reports "))):n.a.createElement("ul",null,n.a.createElement("li",null,n.a.createElement(m.b,{to:"/",exact:!0},"Home"))),n.a.createElement("div",{className:"user"},n.a.createElement("div",null," Hello ",null===(t=this.state.user)||void 0===t?void 0:t.firstName," "),n.a.createElement("div",null,n.a.createElement(T.a,{onClick:this.logOut},"Log out"))))),n.a.createElement("div",{className:"space"}))}}]),a}(r.Component),G=Object(h.f)(W),R=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.getComponentData=Object(l.a)(c.a.mark((function e(){var t,a,n,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==N.getState().vacations.length){e.next=7;break}return e.next=4,w.get("/api/vacations");case 4:t=e.sent,a=t.data,N.dispatch({type:k.SaveAllVacations,payload:a});case 7:if(0!==N.getState().follows.length){e.next=15;break}return e.next=10,w.get("/api/follows");case 10:n=e.sent,s=n.data,N.dispatch({type:k.SaveAllFollows,payload:s}),N.dispatch({type:k.setFollowsPerVacation}),N.dispatch({type:k.sortVacations});case 15:e.next=20;break;case 17:e.prev=17,e.t0=e.catch(0),M(e.t0,r.props);case 20:case"end":return e.stop()}}),e,null,[[0,17]])}))),r.addFollow=function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new f).userName=N.getState().user.userName,a.vacationId=t,e.prev=3,e.next=6,w.post("/api/follows",a);case 6:(n=e.sent).data&&(s=n.data,r.socket.emit("user-added-a-follow-from-client",s)),e.next=13;break;case 10:e.prev=10,e.t0=e.catch(3),M(e.t0,r.props);case 13:case"end":return e.stop()}}),e,null,[[3,10]])})));return function(t){return e.apply(this,arguments)}}(),r.removeFollow=function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=N.getState().user.userName,n=r.state.follows.find((function(e){return e.userName===a&&e.vacationId===t})),e.prev=2,e.next=5,w.delete("/api/follows/".concat(n.followId));case 5:r.socket.emit("user-removed-a-follow-from-client",n.followId),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(2),M(e.t0,r.props);case 11:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),r.state={vacations:N.getState().vacations,follows:N.getState().follows,isLoggedIn:N.getState().isLoggedIn},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var e=N.getState().vacations,a=N.getState().follows,r=N.getState().isLoggedIn;t.setState({vacations:e,follows:a,isLoggedIn:r})})),this.getComponentData();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"home"},n.a.createElement(G,null),n.a.createElement("div",{className:"card-container"},this.state.vacations.map((function(t){return n.a.createElement(I.a,{key:t.vacationId},n.a.createElement("div",{className:"zoom-effect-container"},n.a.createElement("div",{className:"image-card"},n.a.createElement(I.a.Img,{variant:"top",className:"img",src:b.serverUrl+"/assets/images/vacations/"+t.img}))),n.a.createElement(I.a.Body,null,t.isFollow?n.a.createElement(A.a,{className:"star-fill",color:"yellow",size:"1.5rem",onClick:function(){return e.removeFollow(t.vacationId)}}):n.a.createElement(A.a,{className:"star-fill",color:"grey",size:"1.5rem",onClick:function(){return e.addFollow(t.vacationId)}}),n.a.createElement(I.a.Title,null,t.destination),n.a.createElement(I.a.Text,null,t.description)),n.a.createElement(F.a,{className:"list-group-flush"},n.a.createElement(C.a,null,"Follows: ",t.follows),n.a.createElement(C.a,null,"Start: ",new Date(t.startingDate).toDateString()),n.a.createElement(C.a,null,"end: ",new Date(t.endingDate).toDateString()),n.a.createElement(C.a,null,"Cost: ",t.price,"$"),n.a.createElement(C.a,null,n.a.createElement(m.b,{className:"purchase",to:"/purchase/"+t.vacationId,exact:!0}," purchase "))))}))))}}]),a}(r.Component),_=(a(181),function e(t,a,r,n,s,o){Object(u.a)(this,e),this.firstName=t,this.lastName=a,this.userName=r,this.password=n,this.isAdmin=s,this.captchaToken=o});function H(e){return""===e?"Missing user name":e.length<2?"User name too short":e.length>15?"User name too long":""}function Y(e){return""===e?"Missing password":e.length<6?"password is too short":e.length>10?"password is too long":""}var z=a(117),K=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).recaptchaRef=void 0,r.setUserName=function(e){var t,a=e.target.value;"user name is not available"!==(t=function(e,t){var a="";return t.forEach((function(t){e===t.userName&&(a="user name is not available")})),a}(a,r.state.usersNames))&&(t=H(a));var n=Object(D.a)({},r.state.errors);n.userNameError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.userName=a,r.setState({user:s})},r.setFirstName=function(e){var t=e.target.value,a=function(e){return""===e?"Missing first name":e.length<2?"first name is too short":e.length>10?"first name is too long":"A"<=e[0]&&e[0]<="Z"?"":"first name must start with a capital letter"}(t),n=Object(D.a)({},r.state.errors);n.firstNameError=a,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.firstName=t,r.setState({user:s})},r.setLastName=function(e){var t=e.target.value,a=function(e){return""===e?"Missing last name":e.length<2?"last name is too short":e.length>10?"last name is too long":"A"<=e[0]&&e[0]<="Z"?"":"first name must start with a capital letter"}(t),n=Object(D.a)({},r.state.errors);n.lastNameError=a,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.lastName=t,r.setState({user:s})},r.setPassword=function(e){var t=e.target.value,a=Y(t),n=Object(D.a)({},r.state.errors);n.passwordError=a,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.password=t,r.setState({user:s})},r.verifyPasswordUser=function(e){var t=function(e,t){return""===e?"Missing verified password":e!==t?"verify password":""}(e.target.value,Object(D.a)({},r.state.user).password),a=Object(D.a)({},r.state.errors);a.verifyPasswordError=t,r.setState({errors:a})},r.isFormLegal=function(){for(var e in r.state.errors)if(""!==r.state.errors[e].toString())return!1;return!0},r.register=function(){var e=Object(l.a)(c.a.mark((function e(t){var a,n,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),e.next=4,r.recaptchaRef.executeAsync();case 4:return a=e.sent,console.log(a),r.recaptchaRef.reset(),(n=Object(D.a)({},r.state.user)).captchaToken=a,e.next=11,y.post("/api/auth/register",n,{withCredentials:!0});case 11:s=e.sent,N.dispatch({type:k.saveUser,payload:s.data.user}),N.dispatch({type:k.saveToken,payload:s.data.accessToken}),(new j.a).set("user",s.data.user,{path:"/",maxAge:86400}),r.props.history.push("/"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(0),M(e.t0,r.props);case 22:case"end":return e.stop()}}),e,null,[[0,19]])})));return function(t){return e.apply(this,arguments)}}(),r.state={user:new _,usersNames:[],captchaIsVerified:!1,errors:{userNameError:"*",firstNameError:"*",lastNameError:"*",passwordError:"*",verifyPasswordError:"*",captcha:""}},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(Object({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,REACT_APP_CAPTCHA_SITE_KEY:"6Lf3pIEfAAAAABYTpOA6vODFOC72nldOHHEMD1KP"}),"env"),!N.getState().user){e.next=4;break}return this.props.history.push("/"),e.abrupt("return");case 4:this.getAllUsersNames();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getAllUsersNames",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,y.get("/api/auth/usersNames");case 3:t=e.sent,a=t.data,this.setState({usersNames:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),M(e.t0,this.props);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"registration"},n.a.createElement("div",{className:"card-registration"},n.a.createElement("h1",null,"Sign up"),n.a.createElement("form",{action:""},n.a.createElement("div",{className:"input-box"},n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"User Name",onChange:this.setUserName}),n.a.createElement("span",{className:"error"},"*"===this.state.errors.userNameError?"":this.state.errors.userNameError)),n.a.createElement("div",{className:"input-box"},n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"First Name",onChange:this.setFirstName}),n.a.createElement("span",{className:"error"},"*"===this.state.errors.firstNameError?"":this.state.errors.firstNameError)),n.a.createElement("div",{className:"input-box"},n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"Last Name",onChange:this.setLastName}),n.a.createElement("span",{className:"error"},"*"===this.state.errors.lastNameError?"":this.state.errors.lastNameError)),n.a.createElement("div",{className:"input-box"},n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Password",onChange:this.setPassword}),n.a.createElement("span",{className:"error"},"*"===this.state.errors.passwordError?"":this.state.errors.passwordError)),n.a.createElement("div",{className:"input-box"},n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Verify Password",onChange:this.verifyPasswordUser}),n.a.createElement("span",{className:"error"},"*"===this.state.errors.verifyPasswordError?"":this.state.errors.verifyPasswordError)),n.a.createElement(z.a,{sitekey:"6Lf3pIEfAAAAABYTpOA6vODFOC72nldOHHEMD1KP",size:"invisible",ref:function(t){return e.recaptchaRef=t}}),n.a.createElement(T.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.register},"Sign up")),n.a.createElement(m.b,{className:"navigate",to:"/login",exact:!0},"Do you have an account? ",n.a.createElement("br",null)," Sign in now")))}}]),a}(r.Component),q=(a(182),function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).setUserName=function(e){var t=e.target.value,a=H(t),n=Object(D.a)({},r.state.errors);n.userNameError=a,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.userName=t,r.setState({user:s})},r.setPassword=function(e){var t=e.target.value,a=Y(t),n=Object(D.a)({},r.state.errors);n.passwordError=a,r.setState({errors:n});var s=Object(D.a)({},r.state.user);s.password=t,r.setState({user:s})},r.isFormLegal=function(){for(var e in r.state.errors)if(""!==r.state.errors[e].toString())return!1;return!0},r.login=function(){var e=Object(l.a)(c.a.mark((function e(t){var a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t.preventDefault(),e.next=4,w.post("/api/auth/login",r.state.user,{withCredentials:!0});case 4:a=e.sent,N.dispatch({type:k.saveUser,payload:a.data.user}),N.dispatch({type:k.saveToken,payload:a.data.accessToken}),(new j.a).set("user",a.data.user,{path:"/",maxAge:86400}),r.props.history.push("/"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(0),M(e.t0,r.props);case 15:case"end":return e.stop()}}),e,null,[[0,12]])})));return function(t){return e.apply(this,arguments)}}(),r.state={user:new _,errors:{userNameError:"*",passwordError:"*"}},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){N.getState().user&&this.props.history.push("/")}},{key:"render",value:function(){return n.a.createElement("div",{className:"login"},n.a.createElement("div",{className:"card-login"},n.a.createElement("form",{className:"form-login",onSubmit:this.login},n.a.createElement("h1",null,"Login"),n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"User Name",onChange:this.setUserName}),n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Password",onChange:this.setPassword}),n.a.createElement("br",null),n.a.createElement(T.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal()},"Login")),n.a.createElement(m.b,{className:"navigate",to:"/registration",exact:!0},"Not a member? Sign up now")))}}]),a}(r.Component)),$=(a(183),a(286)),Z=a(287),J=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.getDataWithAjax=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.get("/api/vacations");case 3:t=e.sent,a=t.data,N.dispatch({type:k.SaveAllVacations,payload:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),M(e.t0,r.props);case 11:case"end":return e.stop()}}),e,null,[[0,8]])}))),r.state={vacations:N.getState().vacations,isLoggedIn:N.getState().isLoggedIn},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:if(P(this.props)){e.next=4;break}return e.abrupt("return");case 4:if(this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var e=N.getState().vacations;t.setState({vacations:e})})),!(this.state.vacations.length>0)){e.next=8;break}return e.abrupt("return");case 8:this.getDataWithAjax();case 9:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"delete",value:function(){var e=Object(l.a)(c.a.mark((function e(t){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,w.delete("/api/vacations/".concat(t));case 3:this.socket.emit("Admin-removed-a-vacation-from-client",t),e.next=9;break;case 6:e.prev=6,e.t0=e.catch(0),M(e.t0,this.props);case 9:case"end":return e.stop()}}),e,this,[[0,6]])})));return function(t){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"home"},n.a.createElement(G,null),n.a.createElement("div",{className:"card-container"},this.state.vacations.map((function(t){return n.a.createElement(I.a,{key:t.vacationId},n.a.createElement("div",{className:"zoom-effect-container"},n.a.createElement("div",{className:"image-card"},n.a.createElement(I.a.Img,{variant:"top",className:"img",src:b.serverUrl+"/assets/images/vacations/"+t.img}))),n.a.createElement(I.a.Body,null,n.a.createElement($.a,{className:"delete",color:"black",size:"1.5rem",onClick:function(){return e.delete(t.vacationId)}}),n.a.createElement(m.b,{to:"/admin/"+t.vacationId},n.a.createElement(Z.a,{color:"black",size:"1.5rem"})),n.a.createElement(I.a.Title,null,t.destination),n.a.createElement(I.a.Text,null,t.description)),n.a.createElement(F.a,{className:"list-group-flush"},n.a.createElement(C.a,null,"Start: ",new Date(t.startingDate).toDateString()),n.a.createElement(C.a,null,"end: ",new Date(t.endingDate).toDateString()),n.a.createElement(C.a,null,"Cost: ",t.price,"$")))}))),n.a.createElement("br",null))}}]),a}(r.Component),Q=a(49);a(184);function X(e){var t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}function ee(e){var t=new Date(e);return t.setDate(t.getDate()-1),t.setHours(24),t.toJSON()}function te(e){return""===e?"Missing description":e.length<3?"Description is too short":e.length>200?"Description is too long":""}function ae(e){return""===e?"Missing destination":e.length<2?"Destination is too short":e.length>30?"Destination is too long":"A"<=e[0]&&e[0]<="Z"?"":"Destination must start with a capital letter"}function re(e){return e?e<0?"Price can't be negative":e>5e4?"Price is too high":"":"Missing price"}var ne=a(5),se=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.setDescription=function(e){var t,a=e.target.value;t=te(a);var n=Object(D.a)({},r.state.errors);n.descriptionError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.description=a,r.setState({vacation:s})},r.setDestination=function(e){var t,a=e.target.value;t=ae(a);var n=Object(D.a)({},r.state.errors);n.destinationError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.destination=a,r.setState({vacation:s})},r.onFileChange=function(e){var t=e.target.files[0];r.setImgUrl(t.name),r.setState({file:t})},r.setImgUrl=function(e){var t=e;var a=Object(D.a)({},r.state.errors);a.imgError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.img=t,r.setState({vacation:n})},r.setStartingDate=function(e){var t=e.target.value;var a=Object(D.a)({},r.state.errors);a.startingDateError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.startingDate=t,r.setState({vacation:n})},r.setEndingDate=function(e){var t=e.target.value;var a=Object(D.a)({},r.state.errors);a.endingDateError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.endingDate=t,r.setState({vacation:n})},r.setPrice=function(e){var t,a=+e.target.value;t=re(a);var n=Object(D.a)({},r.state.errors);n.priceError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.price=a,r.setState({vacation:s})},r.update=Object(l.a)(c.a.mark((function e(){var t,a;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,!r.state.file){e.next=6;break}return(t=new FormData).append("file",r.state.file),e.next=6,w.post("/upload-image",t);case 6:return a=Object(D.a)({},r.state.vacation),e.next=9,w.put("/api/vacations/".concat(+r.props.match.params.id),a);case 9:a.startingDate=ee(a.startingDate),a.endingDate=ee(a.endingDate),r.socket.emit("Admin-updated-a-vacation-from-client",a),r.props.history.push("/admin"),e.next=18;break;case 15:e.prev=15,e.t0=e.catch(0),M(e.t0,r.props);case 18:case"end":return e.stop()}}),e,null,[[0,15]])}))),r.state={vacations:N.getState().vacations,vacation:{},isLoggedIn:N.getState().isLoggedIn,file:null,errors:{descriptionError:"",destinationError:"",imgError:"",startingDateError:"",endingDateError:"",priceError:""}},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,r,n,s,o=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:if(P(this.props)){e.next=4;break}return e.abrupt("return");case 4:if(this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var e=N.getState().vacations,t=N.getState().isLoggedIn;o.setState({vacations:e,isLoggedIn:t})})),!(this.state.vacations.length>0)){e.next=11;break}a=Object(Q.a)(this.state.vacations);try{for(a.s();!(r=a.n()).done;)(n=r.value).vacationId===+this.props.match.params.id&&(t=Object(D.a)({},n))}catch(i){a.e(i)}finally{a.f()}e.next=21;break;case 11:return e.prev=11,e.next=14,w.get("/api/vacations/".concat(+this.props.match.params.id));case 14:s=e.sent,t=s.data,e.next=21;break;case 18:e.prev=18,e.t0=e.catch(11),M(e.t0,this.props);case 21:t.startingDate=X(t.startingDate),t.endingDate=X(t.endingDate),this.setState({vacation:t});case 24:case"end":return e.stop()}}),e,this,[[11,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"isFormLegal",value:function(){for(var e in this.state.errors)if(""!==this.state.errors[e].toString())return!1;return!0}},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"EditVacation"},n.a.createElement(G,null),n.a.createElement("div",{className:"form-container"},n.a.createElement("h1",null,"Edit Vacation"),n.a.createElement("br",null),n.a.createElement(ne.a.Group,{controlId:"formTextDestination"},n.a.createElement(ne.a.Label,null,"Destination"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.destination||"",onChange:this.setDestination}),n.a.createElement(ne.a.Text,{className:"text-muted"},this.state.errors.destinationError)),n.a.createElement(ne.a.Group,{controlId:"formTextDescription"},n.a.createElement(ne.a.Label,null,"Description"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.description||"",onChange:this.setDescription}),n.a.createElement(ne.a.Text,{className:"text-muted"},this.state.errors.descriptionError)),n.a.createElement(ne.a.Group,{controlId:"formFileImage"},n.a.createElement(ne.a.Label,null,"Upload image"),n.a.createElement(ne.a.Control,{type:"file",name:"file",onChange:this.onFileChange})),n.a.createElement(ne.a.Group,{controlId:"formStartDate"},n.a.createElement(ne.a.Label,null,"Start Date"),n.a.createElement(ne.a.Control,{type:"date",placeholder:"Enter description",value:this.state.vacation.startingDate||"",onChange:this.setStartingDate}),n.a.createElement(ne.a.Text,{className:"text-muted"},this.state.errors.startingDateError)),n.a.createElement(ne.a.Group,{controlId:"formEndingDate"},n.a.createElement(ne.a.Label,null,"Ending Date"),n.a.createElement(ne.a.Control,{type:"date",placeholder:"Enter description",value:this.state.vacation.endingDate||"",onChange:this.setEndingDate}),n.a.createElement(ne.a.Text,{className:"text-muted"},this.state.errors.endingDateError)),n.a.createElement(ne.a.Group,{controlId:"formTextPrice"},n.a.createElement(ne.a.Label,null,"Price"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.price||"",onChange:this.setPrice}),n.a.createElement(ne.a.Text,{className:"text-muted"},this.state.errors.priceError)),n.a.createElement(T.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.update},"Submit")))}}]),a}(r.Component),oe=(a(186),function e(t,a,r,n,s,o,i,c,l){Object(u.a)(this,e),this.vacationId=t,this.description=a,this.destination=r,this.img=n,this.startingDate=s,this.endingDate=o,this.price=i,this.follows=c,this.isFollow=l}),ie=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).socket=void 0,r.setDescription=function(e){var t,a=e.target.value;t=te(a);var n=Object(D.a)({},r.state.errors);n.descriptionError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.description=a,r.setState({vacation:s})},r.setDestination=function(e){var t,a=e.target.value;t=ae(a);var n=Object(D.a)({},r.state.errors);n.destinationError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.destination=a,r.setState({vacation:s})},r.onFileChange=function(e){var t=e.target.files[0];console.log("File: "),console.log(t),t&&(r.setImgUrl(t.name),r.setState({file:t}))},r.setImgUrl=function(e){var t=e;var a=Object(D.a)({},r.state.errors);a.imgError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.img=t,r.setState({vacation:n})},r.setStartingDate=function(e){var t=e.target.value;var a=Object(D.a)({},r.state.errors);a.startingDateError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.startingDate=t,r.setState({vacation:n})},r.setEndingDate=function(e){var t=e.target.value;var a=Object(D.a)({},r.state.errors);a.endingDateError="",r.setState({errors:a});var n=Object(D.a)({},r.state.vacation);n.endingDate=t,r.setState({vacation:n})},r.setPrice=function(e){var t,a=+e.target.value;t=re(a);var n=Object(D.a)({},r.state.errors);n.priceError=t,r.setState({errors:n});var s=Object(D.a)({},r.state.vacation);s.price=a,r.setState({vacation:s})},r.add=Object(l.a)(c.a.mark((function e(){var t,a,n,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=Object(D.a)({},r.state.vacation),console.log("this.state.file"),console.log(r.state.file),(a=new FormData).append("file",r.state.file),e.prev=5,e.next=8,w.post("/upload-image",a,{headers:{"Content-Type":"multipart/form-data"}});case 8:return e.next=10,w.post("/api/vacations",t);case 10:n=e.sent,(s=n.data).follows=0,s.startingDate=ee(s.startingDate),s.endingDate=ee(s.endingDate),r.socket.emit("Admin-added-a-vacation-from-client",s),r.props.history.push("/admin"),e.next=22;break;case 19:e.prev=19,e.t0=e.catch(5),M(e.t0,r.props);case 22:case"end":return e.stop()}}),e,null,[[5,19]])}))),r.state={vacation:new oe,isLoggedIn:N.getState().isLoggedIn,file:null,errors:{descriptionError:"*",destinationError:"*",imgError:"*",startingDateError:"*",endingDateError:"*",priceError:"*"}},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:if(P(this.props)){e.next=4;break}return e.abrupt("return");case 4:this.socket=S.a.connect(b.serverUrl);case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isFormLegal",value:function(){for(var e in this.state.errors)if(""!==this.state.errors[e].toString())return!1;return!0}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.socket)||void 0===e||e.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"EditVacation"},n.a.createElement(G,null),n.a.createElement("div",{className:"edit-container"},n.a.createElement("h1",null,"Add Vacation"),n.a.createElement("br",null),n.a.createElement(ne.a.Group,{controlId:"formTextDestination"},n.a.createElement(ne.a.Label,null,"Destination"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter destination",value:this.state.vacation.destination||"",onChange:this.setDestination}),n.a.createElement(ne.a.Text,{className:"text-muted"},"*"===this.state.errors.destinationError?"":this.state.errors.destinationError)),n.a.createElement(ne.a.Group,{controlId:"formTextDescription"},n.a.createElement(ne.a.Label,null,"Description"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.description||"",onChange:this.setDescription}),n.a.createElement(ne.a.Text,{className:"text-muted"},"*"===this.state.errors.descriptionError?"":this.state.errors.descriptionError)),n.a.createElement(ne.a.Group,{controlId:"formFileImage"},n.a.createElement(ne.a.Label,null,"Upload image"),n.a.createElement(ne.a.Control,{type:"file",name:"file",onChange:this.onFileChange})),n.a.createElement(ne.a.Group,{controlId:"formStartDate"},n.a.createElement(ne.a.Label,null,"Start Date"),n.a.createElement(ne.a.Control,{type:"date",value:this.state.vacation.startingDate||"",onChange:this.setStartingDate}),n.a.createElement(ne.a.Text,{className:"text-muted"},"*"===this.state.errors.startingDateError?"":this.state.errors.startingDateError)),n.a.createElement(ne.a.Group,{controlId:"formEndingDate"},n.a.createElement(ne.a.Label,null,"Ending Date"),n.a.createElement(ne.a.Control,{type:"date",value:this.state.vacation.endingDate||"",onChange:this.setEndingDate}),n.a.createElement(ne.a.Text,{className:"text-muted"},"*"===this.state.errors.endingDateError?"":this.state.errors.endingDateError)),n.a.createElement(ne.a.Group,{controlId:"formTextPrice"},n.a.createElement(ne.a.Label,null,"Price"),n.a.createElement(ne.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.price||"",onChange:this.setPrice}),n.a.createElement(ne.a.Text,{className:"text-muted"},"*"===this.state.errors.priceError?"":this.state.errors.priceError)),n.a.createElement(T.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.add},"Submit")))}}]),a}(r.Component),ce=(a(187),a(115));var le=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).socket=void 0,r.unsubscribeStore=void 0,r.updateGraphState=function(){var e=[],t=[],a=[];N.getState().vacations.forEach((function(r){r.follows>0&&(e.push(r.destination),t.push(r.follows),a.push(function(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),a=Math.floor(255*Math.random());return"rgba(".concat(e,",").concat(t,",").concat(a,",0.5)")}()))})),r.setState({vacationsDestinations:e,vacationsFollows:t,colors:a})},r.state={isLoggedIn:N.getState().isLoggedIn,vacationsDestinations:[],vacationsFollows:[],colors:[]},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:if(P(this.props)){e.next=4;break}return e.abrupt("return");case 4:this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var e=N.getState().isLoggedIn;t.setState({isLoggedIn:e}),N.getState().vacations.length>0&&N.getState().follows.length>0&&t.updateGraphState()})),this.getComponentData();case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getComponentData",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t,a,r,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=N.getState().vacations,a=N.getState().follows,e.prev=2,0!==t.length){e.next=9;break}return e.next=6,w.get("/api/vacations");case 6:r=e.sent,t=r.data,N.dispatch({type:k.SaveAllVacations,payload:t});case 9:if(0!==a.length){e.next=15;break}return e.next=12,w.get("/api/follows");case 12:n=e.sent,a=n.data,N.dispatch({type:k.SaveAllFollows,payload:a});case 15:N.dispatch({type:k.setFollowsPerVacation}),e.next=22;break;case 18:return e.prev=18,e.t0=e.catch(2),M(e.t0,this.props),e.abrupt("return");case 22:this.updateGraphState();case 23:case"end":return e.stop()}}),e,this,[[2,18]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"reports"},n.a.createElement(G,null),n.a.createElement("br",null),n.a.createElement(ce.Bar,{data:{labels:this.state.vacationsDestinations,datasets:[{label:"Follows",data:this.state.vacationsFollows,backgroundColor:this.state.colors}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,userCallback:function(e,t,a){if(Math.floor(e)===e)return e}}}]}}}))}}]),a}(r.Component),ue=(a(282),function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.getComponentData=Object(l.a)(c.a.mark((function e(){var t,a,n,s,o,i;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(r.state.vacations.length>0)){e.next=5;break}a=Object(Q.a)(r.state.vacations);try{for(a.s();!(n=a.n()).done;)(s=n.value).vacationId===+r.props.match.params.id&&(t=Object(D.a)({},s))}catch(c){a.e(c)}finally{a.f()}e.next=15;break;case 5:return e.prev=5,e.next=8,w.get("/api/vacations/".concat(+r.props.match.params.id));case 8:o=e.sent,t=o.data,e.next=15;break;case 12:e.prev=12,e.t0=e.catch(5),M(e.t0,r.props);case 15:t.startingDate=X(t.startingDate),t.endingDate=X(t.endingDate),r.setState({vacation:t}),(i=Object(D.a)({},r.state.purchase)).vacationId=t.vacationId,i.userName=N.getState().user.userName,i.priceForTicket=t.price,r.setState({purchase:i});case 23:case"end":return e.stop()}}),e,null,[[5,12]])}))),r.setAmountOfTickets=function(e){var t=Object(D.a)({},r.state.purchase);t.tickets=+e.target.value,t.totalPrice=t.tickets*r.state.vacation.price,r.setState({purchase:t})},r.send=Object(l.a)(c.a.mark((function e(){var t,a,n;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=new Date,(a=Object(D.a)({},r.state.purchase)).date=t,e.prev=3,e.next=6,w.post("/api/purchases",a);case 6:n=e.sent,a=n.data,r.socket.emit("user-added-a-purchase-from-client",a),r.props.history.push("/"),e.next=15;break;case 12:e.prev=12,e.t0=e.catch(3),M(e.t0,r.props);case 15:case"end":return e.stop()}}),e,null,[[3,12]])}))),r.state={vacations:N.getState().vacations,purchase:{},vacation:{},isLoggedIn:N.getState().isLoggedIn,errors:{descriptionError:"",destinationError:"",imgError:"",startingDateError:"",endingDateError:"",priceError:""}},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=Object(l.a)(c.a.mark((function e(){var t=this;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(L(this.props)){e.next=2;break}return e.abrupt("return");case 2:this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var e=N.getState().vacations;t.setState({vacations:e})})),this.getComponentData();case 5:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isFormLegal",value:function(){return!(this.state.purchase.totalPrice<=0)}},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"purchaseVacation"},n.a.createElement(G,null),n.a.createElement("div",{className:"card-container"},n.a.createElement(I.a,{className:"card-purchase"},n.a.createElement(I.a.Header,null,n.a.createElement("div",{className:"header"},n.a.createElement("img",{className:"img",alt:"vacation",src:"".concat(b.serverUrl,"/assets/images/vacations/").concat(this.state.vacation.img)}),n.a.createElement("span",{className:"destination"},this.state.vacation.destination||""))),n.a.createElement(I.a.Body,null,n.a.createElement(I.a.Title,null,"Description:"),n.a.createElement(I.a.Text,null,this.state.vacation.description||""),n.a.createElement(I.a.Title,null,"Vacation Date:"),n.a.createElement(I.a.Text,null,"From ",new Date(this.state.vacation.startingDate).toDateString()," to  ",new Date(this.state.vacation.endingDate).toDateString()),n.a.createElement(I.a.Title,null,"One ticket cost:"),n.a.createElement(I.a.Text,null,this.state.vacation.price||"","$")),n.a.createElement(I.a.Header,null,n.a.createElement("h2",null,"Purchase")),n.a.createElement(I.a.Body,null,n.a.createElement(I.a.Text,null,"Number Of tickets: ",n.a.createElement("input",{type:"text",pattern:"[0-9]*",onInput:this.setAmountOfTickets.bind(this),value:this.state.purchase.tickets})),n.a.createElement(I.a.Text,null,"Total price: ",this.state.purchase.totalPrice||"","$"),n.a.createElement(I.a.Text,null,n.a.createElement(T.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.send},"Buy"))))))}}]),a}(r.Component)),pe=(a(283),a(116)),de=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.getComponentDataWithAxios=Object(l.a)(c.a.mark((function e(){var t,a,n,s;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,0!==N.getState().vacations.length){e.next=7;break}return e.next=4,w.get("/api/vacations");case 4:t=e.sent,a=t.data,N.dispatch({type:k.SaveAllVacations,payload:a});case 7:if(0!==N.getState().purchases.length){e.next=14;break}return e.next=10,w.get("/api/purchases");case 10:n=e.sent,(s=n.data).forEach((function(e){e.vacation=N.getState().vacations.find((function(t){return t.vacationId===e.vacationId}))})),N.dispatch({type:k.saveAllPurchases,payload:s});case 14:e.next=19;break;case 16:e.prev=16,e.t0=e.catch(0),M(e.t0,r.props);case 19:case"end":return e.stop()}}),e,null,[[0,16]])}))),r.state={purchases:N.getState().purchases,isLoggedIn:N.getState().isLoggedIn},r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){var e=this;L(this.props)&&P(this.props)&&(this.socket=S.a.connect(b.serverUrl),this.unsubscribeStore=N.subscribe((function(){var t=N.getState().purchases;e.setState({purchases:t})})),this.getComponentDataWithAxios())}},{key:"componentWillUnmount",value:function(){var e,t;null===(e=this.unsubscribeStore)||void 0===e||e.call(this),null===(t=this.socket)||void 0===t||t.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"purchases"},n.a.createElement(G,null),n.a.createElement("div",{className:"table-container"},n.a.createElement("h1",null,"Purchases"),n.a.createElement("br",null),n.a.createElement(pe.a,{striped:!0,bordered:!0,hover:!0},n.a.createElement("thead",null,n.a.createElement("tr",null,n.a.createElement("th",null,"User Name"),n.a.createElement("th",null,"Number of Tickets"),n.a.createElement("th",null,"Total price"),n.a.createElement("th",null,"Vacation"),n.a.createElement("th",null,"Date"))),n.a.createElement("tbody",null,this.state.purchases?this.state.purchases.map((function(e){return n.a.createElement("tr",{key:e.purchaseId},n.a.createElement("td",null,e.userName),n.a.createElement("td",null,e.tickets),n.a.createElement("td",null,e.totalPrice,"$"),n.a.createElement("td",null,e.vacation.destination),n.a.createElement("td",null,new Date(e.date).toDateString()))})):""))))}}]),a}(r.Component),ve=function(e){Object(d.a)(a,e);var t=Object(v.a)(a);function a(e){var r;return Object(u.a)(this,a),(r=t.call(this,e)).socket=void 0,r.reqInterceptor=function(e){return e.headers.authorization||(e.headers.authorization="Bearer ".concat(N.getState().token)),console.log("req headers before: "),console.log(e.headers),console.log("req before: "),console.log(e),e},r.resInterceptor=function(e){return console.log("res"),console.log(e),e},r.resErrInterceptor=function(){var e=Object(l.a)(c.a.mark((function e(t){var a,r,n,s,o;return c.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(console.log(null===t||void 0===t?void 0:t.config),console.log(null===t||void 0===t?void 0:t.config.url),n=null===t||void 0===t?void 0:t.config,"/api/auth/refresh"===(null===t||void 0===t?void 0:t.config.url)||"You are not logged-in"!==(null===t||void 0===t||null===(a=t.response)||void 0===a?void 0:a.data)&&"Your login session has expired"!==(null===t||void 0===t||null===(r=t.response)||void 0===r?void 0:r.data)){e.next=19;break}return e.prev=4,console.log("refresh"),e.next=8,w.get("/api/auth/refresh");case 8:return s=e.sent,console.log("after refresh"),o=s.data.accessToken,N.dispatch({type:k.saveToken,payload:o}),n.headers.authorization="Bearer ".concat(o),e.abrupt("return",y(n));case 16:throw e.prev=16,e.t0=e.catch(4),e.t0;case 19:throw t;case 20:case"end":return e.stop()}}),e,null,[[4,16]])})));return function(t){return e.apply(this,arguments)}}(),0===w.interceptors.request.handlers.length&&(w.interceptors.request.use(r.reqInterceptor),w.interceptors.response.use(r.resInterceptor,r.resErrInterceptor)),r}return Object(p.a)(a,[{key:"componentDidMount",value:function(){console.log("app componentDidMount"),this.socket=S.a.connect(b.serverUrl),this.socket.on("Admin-updated-a-vacation-from-server",(function(e){N.getState().vacations.length>0&&N.dispatch({type:k.saveOneVacation,payload:e})})),this.socket.on("added-vacation-from-server",(function(e){N.getState().vacations.length>0&&N.dispatch({type:k.addOneVacation,payload:e})})),this.socket.on("removed-vacation-from-server",(function(e){N.getState().vacations.length>0&&N.dispatch({type:k.deleteOneVacation,payload:e})})),this.socket.on("follow-added-from-server",(function(e){N.getState().vacations.length>0&&N.getState().follows.length>0&&(N.dispatch({type:k.AddFollow,payload:e}),N.dispatch({type:k.setFollowsPerVacation}),N.dispatch({type:k.sortVacations}))})),this.socket.on("follow-removed-from-server",(function(e){N.getState().vacations.length>0&&N.getState().follows.length>0&&(N.dispatch({type:k.RemoveFollow,payload:e}),N.dispatch({type:k.setFollowsPerVacation}),N.dispatch({type:k.sortVacations}))})),this.socket.on("purchase-added-from-server",(function(e){N.getState().vacations.length>0&&N.getState().purchases.length>0&&(e.vacation=N.getState().vacations.find((function(t){return t.vacationId===e.vacationId})),N.dispatch({type:k.addPurchase,payload:e}))}))}},{key:"componentWillUnmount",value:function(){var e;console.log("componentWillUnmount"),null===(e=this.socket)||void 0===e||e.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"layout"},n.a.createElement(m.a,null,n.a.createElement(h.c,null,n.a.createElement(h.a,{exact:!0,path:"/",render:function(e){return n.a.createElement(R,Object.assign({},e,{key:"layout"}))}}),n.a.createElement(h.a,{exact:!0,path:"/login",key:"login",render:function(e){return n.a.createElement(q,e)}}),n.a.createElement(h.a,{exact:!0,path:"/registration",key:"registration",render:function(e){return n.a.createElement(K,e)}}),n.a.createElement(h.a,{exact:!0,path:"/purchase/:id",key:"purchase",render:function(e){return n.a.createElement(ue,e)}}),n.a.createElement(h.a,{exact:!0,path:"/purchases",key:"purchases",render:function(e){return n.a.createElement(de,e)}}),n.a.createElement(h.a,{exact:!0,path:"/admin",key:"registration",render:function(e){return n.a.createElement(J,e)}}),n.a.createElement(h.a,{exact:!0,path:"/admin/add",key:"add",render:function(e){return n.a.createElement(ie,e)}}),n.a.createElement(h.a,{exact:!0,path:"/admin/:id",key:"edit",render:function(e){return n.a.createElement(se,e)}}),n.a.createElement(h.a,{exact:!0,path:"/reports",key:"reports",render:function(e){return n.a.createElement(le,e)}}))))}}]),a}(r.Component);o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(ve,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[118,1,2]]]);
//# sourceMappingURL=main.0ea942ad.chunk.js.map