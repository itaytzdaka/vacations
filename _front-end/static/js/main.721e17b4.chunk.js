(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{114:function(e,t,a){e.exports=a(278)},119:function(e,t,a){},120:function(e,t,a){},122:function(e,t,a){},168:function(e,t){},171:function(e,t,a){},176:function(e,t,a){},177:function(e,t,a){},178:function(e,t,a){},179:function(e,t,a){},181:function(e,t,a){},182:function(e,t,a){},278:function(e,t,a){"use strict";a.r(t);var r=a(0),n=a.n(r),s=a(108),o=a.n(s);a(119),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var i,c=a(8),l=a(13),u=a(15),p=a(14),h=(a(120),a(17)),d=a(12),m=a(6),v=a.n(m),f=a(11),g=(a(122),a(9)),b=a.n(g),E=a(109),w=a(3);!function(e){e[e.SaveAllVacations=0]="SaveAllVacations",e[e.SaveAllFollows=1]="SaveAllFollows",e[e.PrepareVacationsForUser=2]="PrepareVacationsForUser",e[e.saveOneVacation=3]="saveOneVacation",e[e.addOneVacation=4]="addOneVacation",e[e.deleteOneVacation=5]="deleteOneVacation",e[e.AddFollow=6]="AddFollow",e[e.RemoveFollow=7]="RemoveFollow"}(i||(i={}));var y=function e(t,a,r,n,s){Object(c.a)(this,e),this.firstName=t,this.lastName=a,this.userName=r,this.password=n,this.isAdmin=s},S=Object(E.a)((function(e,t){var a=Object(w.a)({},e);switch(t.type){case i.SaveAllFollows:a.follows=t.payload;break;case i.SaveAllVacations:a.vacations=t.payload;break;case i.saveOneVacation:for(var r in a.vacations)if(a.vacations[r].vacationId===t.payload.vacationId){var n=a.vacations[r].follows,s=a.vacations[r].isFollow;a.vacations[r]=t.payload,a.vacations[r].follows=n,a.vacations[r].isFollow=s}break;case i.addOneVacation:a.vacations.push(t.payload);break;case i.deleteOneVacation:a.vacations=a.vacations.filter((function(e){return e.vacationId!==t.payload}));break;case i.AddFollow:a.follows.push(t.payload);break;case i.RemoveFollow:a.follows=a.follows.filter((function(e){return e.followId!==t.payload}));break;case i.PrepareVacationsForUser:var o=0;a.vacations.forEach((function(e){e.isFollow=!1,a.follows.forEach((function(t){t.vacationId===e.vacationId&&(o++,t.userName===JSON.parse(sessionStorage.getItem("user")).userName&&(e.isFollow=!0))})),e.follows=o,o=0}));var c=a.vacations.filter((function(e){return!0===e.isFollow})),l=a.vacations.filter((function(e){return!1===e.isFollow}));a.vacations=c.concat(l)}return a}),new function e(){Object(c.a)(this,e),this.vacations=void 0,this.follows=void 0,this.user=void 0,this.vacations=[],this.follows=[],this.user=new y}),k=function e(t,a,r){Object(c.a)(this,e),this.followId=t,this.userName=a,this.vacationId=r},x=a(20),O=a(22),j=a(46),D=a(279),N=a(24),I=a.n(N),C=(a(171),a(31)),F=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).state={user:new y},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){if(sessionStorage.getItem("user")){var e=JSON.parse(sessionStorage.getItem("user"));this.setState({user:e})}}},{key:"logOut",value:function(){sessionStorage.clear()}},{key:"render",value:function(){return n.a.createElement("div",{className:"barMenu"},n.a.createElement("div",{className:"left"},n.a.createElement(h.b,{to:"/",exact:!0},"Home"),this.state.user.isAdmin?n.a.createElement("span",null," |",n.a.createElement(h.b,{to:"/admin",exact:!0}," Admin "),n.a.createElement("span",null,"|"),n.a.createElement(h.b,{to:"/admin/add",exact:!0}," Add Vacation"),n.a.createElement("span",null,"|"),n.a.createElement(h.b,{to:"/reports",exact:!0}," Reports ")):null,n.a.createElement("div",{className:"right"},"Hello ",this.state.user.userName," ")),n.a.createElement("div",null,n.a.createElement(h.b,{to:"/login",exact:!0},n.a.createElement(C.a,{onClick:this.logOut},"Log out"))))}}]),a}(r.Component),A=function(){function e(){Object(c.a)(this,e)}return Object(l.a)(e,null,[{key:"_initialize",value:function(){e.serverUrl="https://itay-vacations.herokuapp.com"}}]),e}();A.serverUrl=void 0,A._initialize();var U=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.addFollow=function(){var e=Object(f.a)(v.a.mark((function e(t){var a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(a=new k).userName=JSON.parse(sessionStorage.getItem("user")).userName,a.vacationId=t,e.prev=3,e.next=6,b.a.post(A.serverUrl+"/api/follows",a);case 6:r.socket.emit("user-changed-a-follow-from-client"),e.next=18;break;case 9:if(e.prev=9,e.t0=e.catch(3),"Your login session has expired"!==e.t0.response.data){e.next=17;break}return sessionStorage.clear(),r.props.history.push("/login"),e.abrupt("return");case 17:alert(e.t0);case 18:case"end":return e.stop()}}),e,null,[[3,9]])})));return function(t){return e.apply(this,arguments)}}(),r.removeFollow=function(){var e=Object(f.a)(v.a.mark((function e(t){var a,n;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return a=JSON.parse(sessionStorage.getItem("user")).userName,n=r.state.follows.find((function(e){return e.userName===a&&e.vacationId===t})),e.prev=2,e.next=5,b.a.delete("".concat(A.serverUrl,"+/api/follows/").concat(n.followId));case 5:r.socket.emit("user-changed-a-follow-from-client"),e.next=17;break;case 8:if(e.prev=8,e.t0=e.catch(2),"Your login session has expired"!==e.t0.response.data){e.next=16;break}return sessionStorage.clear(),r.props.history.push("/login"),e.abrupt("return");case 16:alert(e.t0);case 17:case"end":return e.stop()}}),e,null,[[2,8]])})));return function(t){return e.apply(this,arguments)}}(),r.state={vacations:S.getState().vacations,follows:S.getState().follows},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a,r,n,s=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("token")&&sessionStorage.getItem("user")){e.next=3;break}return this.props.history.push("/login"),e.abrupt("return");case 3:if(this.socket=I.a.connect("http://localhost:3000"),this.unsubscribeStore=S.subscribe((function(){var e=S.getState().vacations,t=S.getState().follows;s.setState({vacations:e,follows:t})})),S.getState().follows.length>0&&S.getState().vacations.length>0){e.next=29;break}return e.prev=6,e.next=9,b.a.get("http://localhost:3000/api/vacations");case 9:return t=e.sent,a=t.data,e.next=13,b.a.get("http://localhost:3000/api/follows");case 13:r=e.sent,n=r.data,S.dispatch({type:i.SaveAllFollows,payload:n}),S.dispatch({type:i.SaveAllVacations,payload:a}),S.dispatch({type:i.PrepareVacationsForUser}),e.next=29;break;case 20:if(e.prev=20,e.t0=e.catch(6),"Your login session has expired"!==e.t0.response.data){e.next=28;break}return sessionStorage.clear(),this.props.history.push("/login"),e.abrupt("return");case 28:alert(e.t0);case 29:this.socket.on("Admin-updated-a-vacation-from-server",(function(e){S.dispatch({type:i.saveOneVacation,payload:e})})),this.socket.on("added-vacation-from-server",(function(e){S.dispatch({type:i.addOneVacation,payload:e})})),this.socket.on("removed-vacation-from-server",(function(e){S.dispatch({type:i.deleteOneVacation,payload:e})})),this.socket.on("follows-updated-from-server",Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,b.a.get("http://localhost:3000/api/follows");case 2:t=e.sent,a=t.data,S.dispatch({type:i.SaveAllFollows,payload:a}),S.dispatch({type:i.PrepareVacationsForUser});case 6:case"end":return e.stop()}}),e)}))));case 33:case"end":return e.stop()}}),e,this,[[6,20]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unsubscribeStore(),this.socket.disconnect()}},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"home"},n.a.createElement(F,null),n.a.createElement("br",null),n.a.createElement("div",{className:"cardContainer"},this.state.vacations.map((function(t){return n.a.createElement(x.a,{style:{width:"18rem"},className:"card",key:t.vacationId},n.a.createElement(x.a.Img,{variant:"top",className:"img",src:"/assets/images/vacations/"+t.img}),n.a.createElement(x.a.Body,null,t.isFollow?n.a.createElement(D.a,{color:"yellow",size:20,onClick:function(){return e.removeFollow(t.vacationId)}}):n.a.createElement(D.a,{color:"grey",size:20,onClick:function(){return e.addFollow(t.vacationId)}}),n.a.createElement(x.a.Title,null,t.destination),n.a.createElement(x.a.Text,null,t.description)),n.a.createElement(j.a,{className:"list-group-flush"},n.a.createElement(O.a,null,"Follows: ",t.follows),n.a.createElement(O.a,null,"Start: ",new Date(t.startingDate).toDateString()),n.a.createElement(O.a,null,"end: ",new Date(t.endingDate).toDateString()),n.a.createElement(O.a,null,"Cost: ",t.price,"$")))}))))}}]),a}(r.Component);a(176);function V(e){return""===e?"Missing user name":e.length<2?"User name too short":e.length>15?"User name too long":""}function L(e){return""===e?"Missing password":e.length<6?"password is too short":e.length>10?"password is too long":""}var P=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).setUserName=function(e){var t,a=e.target.value;"user name is not available"!==(t=function(e,t){var a="";return t.forEach((function(t){e===t.userName&&(a="user name is not available")})),a}(a,r.state.usersNames))&&(t=V(a));var n=Object(w.a)({},r.state.errors);n.userNameError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.userName=a,r.setState({user:s})},r.setFirstName=function(e){var t=e.target.value,a=function(e){return""===e?"Missing first name":e.length<2?"first name is too short":e.length>10?"first name is too long":"A"<=e[0]&&e[0]<="Z"?"":"first name must start with a capital letter"}(t),n=Object(w.a)({},r.state.errors);n.firstNameError=a,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.firstName=t,r.setState({user:s})},r.setLastName=function(e){var t=e.target.value,a=function(e){return""===e?"Missing last name":e.length<2?"last name is too short":e.length>10?"last name is too long":"A"<=e[0]&&e[0]<="Z"?"":"first name must start with a capital letter"}(t),n=Object(w.a)({},r.state.errors);n.lastNameError=a,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.lastName=t,r.setState({user:s})},r.setPassword=function(e){var t=e.target.value,a=L(t),n=Object(w.a)({},r.state.errors);n.passwordError=a,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.password=t,r.setState({user:s})},r.verifyPasswordUser=function(e){var t=function(e,t){return""===e?"Missing verified password":e!==t?"verify password":""}(e.target.value,Object(w.a)({},r.state.user).password),a=Object(w.a)({},r.state.errors);a.verifyPasswordError=t,r.setState({errors:a})},r.isFormLegal=function(){for(var e in r.state.errors)if(""!==r.state.errors[e].toString())return!1;return!0},r.register=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.post(A.serverUrl+"/api/auth/register",r.state.user);case 3:t=e.sent,sessionStorage.setItem("user",JSON.stringify(t.data.user)),sessionStorage.setItem("token",t.data.token),r.props.history.push("/"),e.next=12;break;case 9:e.prev=9,e.t0=e.catch(0),alert(e.t0.message);case 12:case"end":return e.stop()}}),e,null,[[0,9]])}))),r.state={user:new y,usersNames:[],errors:{userNameError:"*",firstNameError:"*",lastNameError:"*",passwordError:"*",verifyPasswordError:"*"}},r}return Object(l.a)(a,[{key:"getAllUsersNames",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get(A.serverUrl+"/api/auth/usersNames");case 3:t=e.sent,a=t.data,this.setState({usersNames:a}),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),alert(e.t0);case 11:case"end":return e.stop()}}),e,this,[[0,8]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentDidMount",value:function(){sessionStorage.getItem("token")?this.props.history.push("/"):this.getAllUsersNames()}},{key:"render",value:function(){return n.a.createElement("div",{className:"registration"},n.a.createElement("div",{className:"cardRegistration"},n.a.createElement("h1",null,"Sign up"),n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"User Name",onChange:this.setUserName}),n.a.createElement("span",null,this.state.errors.userNameError),n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"First Name",onChange:this.setFirstName}),n.a.createElement("span",null,this.state.errors.firstNameError),n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"Last Name",onChange:this.setLastName}),n.a.createElement("span",null,this.state.errors.lastNameError),n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Password",onChange:this.setPassword}),n.a.createElement("span",null,this.state.errors.passwordError),n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Verify Password",onChange:this.verifyPasswordUser}),n.a.createElement("span",null,this.state.errors.verifyPasswordError),n.a.createElement("br",null),n.a.createElement("button",{disabled:!this.isFormLegal(),onClick:this.register},"Sign up"),n.a.createElement(h.b,{className:"navigateLogin",to:"/login",exact:!0},"Do you have an account? Sign in now")))}}]),a}(r.Component),M=(a(177),function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).setUserName=function(e){var t=e.target.value,a=V(t),n=Object(w.a)({},r.state.errors);n.userNameError=a,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.userName=t,r.setState({user:s})},r.setPassword=function(e){var t=e.target.value,a=L(t),n=Object(w.a)({},r.state.errors);n.passwordError=a,r.setState({errors:n});var s=Object(w.a)({},r.state.user);s.password=t,r.setState({user:s})},r.login=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.post(A.serverUrl+"/api/auth/login",r.state.user);case 3:t=e.sent,sessionStorage.setItem("user",JSON.stringify(t.data.user)),sessionStorage.setItem("token",t.data.token),r.props.history.push("/"),e.next=17;break;case 9:if(e.prev=9,e.t0=e.catch(0),"Illegal username or password"!==e.t0.response.data){e.next=16;break}return alert(e.t0.response.data),e.abrupt("return");case 16:alert(e.t0.message);case 17:case"end":return e.stop()}}),e,null,[[0,9]])}))),r.isFormLegal=function(){for(var e in r.state.errors)if(""!==r.state.errors[e].toString())return!1;return!0},r.state={user:new y,errors:{userNameError:"*",passwordError:"*"}},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){sessionStorage.getItem("token")&&JSON.parse(sessionStorage.getItem("user"))&&this.props.history.push("/")}},{key:"render",value:function(){return n.a.createElement("div",{className:"login"},n.a.createElement("div",{className:"cardLogIn"},n.a.createElement("h1",null,"Login"),n.a.createElement("input",{type:"text",name:"",id:"userBox",placeholder:"User Name",onChange:this.setUserName}),n.a.createElement("input",{type:"password",name:"",id:"userBox",placeholder:"Password",onChange:this.setPassword}),n.a.createElement("br",null),n.a.createElement("button",{disabled:!this.isFormLegal(),onClick:this.login},"Login"),n.a.createElement(h.b,{className:"navigate",to:"/registration",exact:!0},"Not a member? Sign up now")))}}]),a}(r.Component)),T=(a(178),a(280)),B=a(281),J=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.getDataWithAjax=Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get(A.serverUrl+"/api/vacations");case 3:t=e.sent,a=t.data,S.dispatch({type:i.SaveAllVacations,payload:a}),e.next=18;break;case 8:if(e.prev=8,e.t0=e.catch(0),"Your login session has expired"!==e.t0.response.data){e.next=17;break}return sessionStorage.clear(),alert(e.t0.response.data),r.props.history.push("/login"),e.abrupt("return");case 17:alert(e.t0);case 18:case"end":return e.stop()}}),e,null,[[0,8]])}))),r.state={vacations:S.getState().vacations},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("token")&&sessionStorage.getItem("user")){e.next=5;break}return this.props.history.push("/login"),e.abrupt("return");case 5:JSON.parse(sessionStorage.getItem("user")).isAdmin||this.props.history.push("/");case 6:if(this.socket=I.a.connect("http://localhost:3000"),this.unsubscribeStore=S.subscribe((function(){var e=S.getState().vacations;t.setState({vacations:e})})),!(this.state.vacations.length>0)){e.next=10;break}return e.abrupt("return");case 10:this.getDataWithAjax(),this.socket.on("Admin-updated-a-vacation-from-server",(function(e){S.dispatch({type:i.saveOneVacation,payload:e})})),this.socket.on("added-vacation-from-server",(function(e){S.dispatch({type:i.addOneVacation,payload:e})})),this.socket.on("removed-vacation-from-server",(function(e){S.dispatch({type:i.deleteOneVacation,payload:e})}));case 14:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unsubscribeStore(),this.socket.disconnect()}},{key:"delete",value:function(){var e=Object(f.a)(v.a.mark((function e(t){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.delete("".concat(A.serverUrl,"+/api/vacations/").concat(t));case 3:S.dispatch({type:i.deleteOneVacation,payload:t}),this.socket.emit("Admin-removed-a-vacation-from-client",t),e.next=17;break;case 7:if(e.prev=7,e.t0=e.catch(0),"Your login session has expired"!==e.t0.response.data){e.next=16;break}return sessionStorage.clear(),alert(e.t0.response.data),this.props.history.push("/login"),e.abrupt("return");case 16:alert(e.t0);case 17:case"end":return e.stop()}}),e,this,[[0,7]])})));return function(t){return e.apply(this,arguments)}}()},{key:"render",value:function(){var e=this;return n.a.createElement("div",{className:"home"},n.a.createElement(F,null),n.a.createElement("br",null),n.a.createElement("div",{className:"cardContainer"},this.state.vacations.map((function(t){return n.a.createElement(x.a,{style:{width:"18rem"},key:t.vacationId},n.a.createElement(x.a.Img,{variant:"top",className:"img",src:"/assets/images/vacations/"+t.img}),n.a.createElement(x.a.Body,null,n.a.createElement(T.a,{color:"black",size:20,onClick:function(){return e.delete(t.vacationId)}}),n.a.createElement(h.b,{to:"/admin/"+t.vacationId},n.a.createElement(B.a,{color:"black",size:20})),n.a.createElement(x.a.Title,null,t.destination),n.a.createElement(x.a.Text,null,t.description)),n.a.createElement(j.a,{className:"list-group-flush"},n.a.createElement(O.a,null,"Start: ",new Date(t.startingDate).toDateString()),n.a.createElement(O.a,null,"end: ",new Date(t.endingDate).toDateString()),n.a.createElement(O.a,null,"Cost: ",t.price,"$")))}))),n.a.createElement("br",null))}}]),a}(r.Component),W=a(113);a(179);function Y(e){var t=new Date(e);return t.setDate(t.getDate()+1),t.toISOString().split("T")[0]}function G(e){var t=new Date(e);return t.setDate(t.getDate()-1),t.setHours(24),t.toJSON()}function z(e){return""===e?"Missing description":e.length<3?"Description is too short":e.length>200?"Description is too long":""}function R(e){return""===e?"Missing destination":e.length<2?"Destination is too short":e.length>30?"Destination is too long":"A"<=e[0]&&e[0]<="Z"?"":"Destination must start with a capital letter"}function Z(e){return e?e<0?"Price can't be negative":e>5e4?"Price is too high":"":"Missing price"}var H=a(4),$=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.setDescription=function(e){var t,a=e.target.value;t=z(a);var n=Object(w.a)({},r.state.errors);n.descriptionError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.description=a,r.setState({vacation:s})},r.setDestination=function(e){var t,a=e.target.value;t=R(a);var n=Object(w.a)({},r.state.errors);n.destinationError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.destination=a,r.setState({vacation:s})},r.setImgUrl=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.imgError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.img=t,r.setState({vacation:n})},r.setStartingDate=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.startingDateError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.startingDate=t,r.setState({vacation:n})},r.setEndingDate=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.endingDateError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.endingDate=t,r.setState({vacation:n})},r.setPrice=function(e){var t,a=+e.target.value;t=Z(a);var n=Object(w.a)({},r.state.errors);n.priceError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.price=a,r.setState({vacation:s})},r.update=Object(f.a)(v.a.mark((function e(){var t;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,t=Object(w.a)({},r.state.vacation),e.next=4,b.a.put("".concat(A.serverUrl,"+/api/vacations/").concat(+r.props.match.params.id),t);case 4:t.startingDate=G(t.startingDate),t.endingDate=G(t.endingDate),S.dispatch({type:i.saveOneVacation,payload:t}),r.socket.emit("Admin-updated-a-vacation-from-client",t),r.props.history.push("/admin"),e.next=26;break;case 11:if(e.prev=11,e.t0=e.catch(0),"Your login session has expired"!==e.t0.response.data){e.next=20;break}return sessionStorage.clear(),alert(e.t0.response.data),r.props.history.push("/login"),e.abrupt("return");case 20:if("You are not admin!"!==e.t0.response.data){e.next=25;break}return r.props.history.push("/login"),e.abrupt("return");case 25:alert(e.t0);case 26:case"end":return e.stop()}}),e,null,[[0,11]])}))),r.state={vacations:S.getState().vacations,vacation:{},errors:{descriptionError:"",destinationError:"",imgError:"",startingDateError:"",endingDateError:"",priceError:""}},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a,r,n,s,o=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(this.socket=I.a.connect("http://localhost:3000"),this.unsubscribeStore=S.subscribe((function(){var e=S.getState().vacations;o.setState({vacations:e})})),sessionStorage.getItem("token")&&sessionStorage.getItem("user")){e.next=7;break}return this.props.history.push("/login"),e.abrupt("return");case 7:JSON.parse(sessionStorage.getItem("user")).isAdmin||this.props.history.push("/");case 8:if(e.prev=8,!(this.state.vacations.length>0)){e.next=14;break}a=Object(W.a)(this.state.vacations);try{for(a.s();!(r=a.n()).done;)(n=r.value).vacationId===+this.props.match.params.id&&(t=Object(w.a)({},n))}catch(i){a.e(i)}finally{a.f()}e.next=18;break;case 14:return e.next=16,b.a.get("http://localhost:3000/api/vacations/".concat(+this.props.match.params.id));case 16:s=e.sent,t=s.data;case 18:t.startingDate=Y(t.startingDate),t.endingDate=Y(t.endingDate),this.setState({vacation:t}),e.next=33;break;case 23:if(e.prev=23,e.t0=e.catch(8),"Your login session has expired"!==e.t0.response.data){e.next=32;break}return sessionStorage.clear(),alert(e.t0.response.data),this.props.history.push("/login"),e.abrupt("return");case 32:alert(e.t0);case 33:case"end":return e.stop()}}),e,this,[[8,23]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unsubscribeStore(),this.socket.disconnect()}},{key:"isFormLegal",value:function(){for(var e in this.state.errors)if(""!==this.state.errors[e].toString())return!1;return!0}},{key:"render",value:function(){return n.a.createElement("div",{className:"EditVacation"},n.a.createElement(F,null),n.a.createElement("br",null),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Destination"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.destination||"",onChange:this.setDestination}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.destinationError)),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Description"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.description||"",onChange:this.setDescription}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.descriptionError)),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Image URL"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.img||"",onChange:this.setImgUrl}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.imgError)),n.a.createElement(H.a.Label,null,"Start Date"),n.a.createElement(H.a.Control,{type:"date",placeholder:"Enter description",value:this.state.vacation.startingDate||"",onChange:this.setStartingDate}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.startingDateError),n.a.createElement(H.a.Label,null,"Ending Date"),n.a.createElement(H.a.Control,{type:"date",placeholder:"Enter description",value:this.state.vacation.endingDate||"",onChange:this.setEndingDate}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.endingDateError),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Price"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.price||"",onChange:this.setPrice}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.priceError)),n.a.createElement(C.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.update},"Submit"))}}]),a}(r.Component),_=(a(181),function e(t,a,r,n,s,o,i,l,u){Object(c.a)(this,e),this.description=t,this.destination=a,this.img=r,this.startingDate=n,this.endingDate=s,this.price=o,this.vacationId=i,this.follows=l,this.isFollow=u}),q=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).socket=void 0,r.setDescription=function(e){var t,a=e.target.value;t=z(a);var n=Object(w.a)({},r.state.errors);n.descriptionError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.description=a,r.setState({vacation:s})},r.setDestination=function(e){var t,a=e.target.value;t=R(a);var n=Object(w.a)({},r.state.errors);n.destinationError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.destination=a,r.setState({vacation:s})},r.setImgUrl=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.imgError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.img=t,r.setState({vacation:n})},r.setStartingDate=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.startingDateError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.startingDate=t,r.setState({vacation:n})},r.setEndingDate=function(e){var t=e.target.value;var a=Object(w.a)({},r.state.errors);a.endingDateError="",r.setState({errors:a});var n=Object(w.a)({},r.state.vacation);n.endingDate=t,r.setState({vacation:n})},r.setPrice=function(e){var t,a=+e.target.value;t=Z(a);var n=Object(w.a)({},r.state.errors);n.priceError=t,r.setState({errors:n});var s=Object(w.a)({},r.state.vacation);s.price=a,r.setState({vacation:s})},r.add=Object(f.a)(v.a.mark((function e(){var t,a;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.post(A.serverUrl+"/api/vacations",r.state.vacation);case 3:t=e.sent,(a=t.data).follows=0,a.startingDate=G(a.startingDate),a.endingDate=G(a.endingDate),console.log(a),S.dispatch({type:i.addOneVacation,payload:a}),r.socket.emit("Admin-added-a-vacation-from-client",a),r.props.history.push("/admin"),e.next=29;break;case 14:if(e.prev=14,e.t0=e.catch(0),"Your login session has expired"!==e.t0.response.data){e.next=23;break}return sessionStorage.clear(),alert(e.t0.response.data),r.props.history.push("/login"),e.abrupt("return");case 23:if("You are not admin!"!==e.t0.response.data){e.next=28;break}return r.props.history.push("/login"),e.abrupt("return");case 28:alert(e.t0);case 29:case"end":return e.stop()}}),e,null,[[0,14]])}))),r.state={vacation:new _,errors:{descriptionError:"*",destinationError:"*",imgError:"*",startingDateError:"*",endingDateError:"*",priceError:"*"}},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("token")&&sessionStorage.getItem("user")){e.next=5;break}return this.props.history.push("/login"),e.abrupt("return");case 5:JSON.parse(sessionStorage.getItem("user")).isAdmin||this.props.history.push("/");case 6:this.socket=I.a.connect("http://localhost:3000");case 7:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isFormLegal",value:function(){for(var e in this.state.errors)if(""!==this.state.errors[e].toString())return!1;return!0}},{key:"componentWillUnmount",value:function(){this.socket.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"EditVacation"},n.a.createElement(F,null),n.a.createElement("br",null),n.a.createElement("p",null,"Add a vacation"),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Destination"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter destination",value:this.state.vacation.destination||"",onChange:this.setDestination}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.destinationError)),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Description"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.description||"",onChange:this.setDescription}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.descriptionError)),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Image URL"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter img",value:this.state.vacation.img||"",onChange:this.setImgUrl}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.imgError)),n.a.createElement(H.a.Label,null,"Start Date"),n.a.createElement(H.a.Control,{type:"date",value:this.state.vacation.startingDate||"",onChange:this.setStartingDate}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.startingDateError),n.a.createElement(H.a.Label,null,"Ending Date"),n.a.createElement(H.a.Control,{type:"date",value:this.state.vacation.endingDate||"",onChange:this.setEndingDate}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.endingDateError),n.a.createElement(H.a.Group,{controlId:"formBasicText"},n.a.createElement(H.a.Label,null,"Price"),n.a.createElement(H.a.Control,{type:"text",placeholder:"Enter description",value:this.state.vacation.price||"",onChange:this.setPrice}),n.a.createElement(H.a.Text,{className:"text-muted"},this.state.errors.priceError)),n.a.createElement(C.a,{variant:"primary",type:"submit",disabled:!this.isFormLegal(),onClick:this.add},"Submit"))}}]),a}(r.Component),K=(a(182),a(112));function Q(){var e=Math.floor(255*Math.random()),t=Math.floor(255*Math.random()),a=Math.floor(255*Math.random());return"rgba(".concat(e,",").concat(t,",").concat(a,",0.5)")}var X=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),(r=t.call(this,e)).unsubscribeStore=void 0,r.socket=void 0,r.state={vacations:S.getState().vacations,follows:S.getState().follows,vacationsDestinations:[],vacationsFollows:[],colors:[]},r}return Object(l.a)(a,[{key:"componentDidMount",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a,r,n=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(sessionStorage.getItem("token")&&sessionStorage.getItem("user")){e.next=5;break}return this.props.history.push("/login"),e.abrupt("return");case 5:JSON.parse(sessionStorage.getItem("user")).isAdmin||this.props.history.push("/");case 6:this.socket=I.a.connect("http://localhost:3000"),this.unsubscribeStore=S.subscribe((function(){var e=S.getState().vacations,t=S.getState().follows;n.setState({vacations:e,follows:t})})),0===this.state.vacations.length||0===this.state.follows.length?this.getDataWithAjax():(t=[],a=[],r=[],this.state.vacations.forEach((function(e){e.follows>0&&(t.push(e.destination),a.push(e.follows),r.push(Q()))})),this.setState({vacationsDestinations:t,vacationsFollows:a,colors:r})),this.socket.on("added-vacation-from-server",(function(e){n.getDataWithAjax()})),this.socket.on("removed-vacation-from-server",(function(e){n.getDataWithAjax()})),this.socket.on("follows-updated-from-server",Object(f.a)(v.a.mark((function e(){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n.getDataWithAjax();case 1:case"end":return e.stop()}}),e)}))));case 12:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"getDataWithAjax",value:function(){var e=Object(f.a)(v.a.mark((function e(){var t,a,r,n,s,o,c;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,b.a.get("http://localhost:3000/api/vacations");case 3:return t=e.sent,a=t.data,e.next=7,b.a.get("http://localhost:3000/api/follows");case 7:r=e.sent,n=r.data,S.dispatch({type:i.SaveAllFollows,payload:n}),S.dispatch({type:i.SaveAllVacations,payload:a}),S.dispatch({type:i.PrepareVacationsForUser}),e.next=24;break;case 14:if(e.prev=14,e.t0=e.catch(0),"Your login session has expired"!==e.t0.response.data){e.next=23;break}return sessionStorage.clear(),alert(e.t0.response.data),this.props.history.push("/login"),e.abrupt("return");case 23:alert(e.t0);case 24:s=[],o=[],c=[],this.state.vacations.forEach((function(e){e.follows>0&&(s.push(e.destination),o.push(e.follows),c.push(Q()))})),this.setState({vacationsDestinations:s,vacationsFollows:o,colors:c});case 29:case"end":return e.stop()}}),e,this,[[0,14]])})));return function(){return e.apply(this,arguments)}}()},{key:"componentWillUnmount",value:function(){this.unsubscribeStore(),this.socket.disconnect()}},{key:"render",value:function(){return n.a.createElement("div",{className:"reports"},n.a.createElement(F,null),n.a.createElement("br",null),n.a.createElement(K.Bar,{data:{labels:this.state.vacationsDestinations,datasets:[{label:"Follows",data:this.state.vacationsFollows,backgroundColor:this.state.colors}]},options:{scales:{yAxes:[{ticks:{beginAtZero:!0,userCallback:function(e,t,a){if(Math.floor(e)===e)return e}}}]}}}))}}]),a}(r.Component),ee=function(e){Object(u.a)(a,e);var t=Object(p.a)(a);function a(e){var r;return Object(c.a)(this,a),r=t.call(this,e),b.a.interceptors.request.use((function(e){return e.headers.authorization="Bearer "+sessionStorage.getItem("token"),e})),b.a.interceptors.response.use((function(e){return e})),r}return Object(l.a)(a,[{key:"render",value:function(){return n.a.createElement("div",{className:"layout"},n.a.createElement(h.a,null,n.a.createElement(d.c,null,n.a.createElement(d.a,{exact:!0,path:"/",render:function(e){return n.a.createElement(U,Object.assign({},e,{key:"layout"}))}}),n.a.createElement(d.a,{exact:!0,path:"/login",key:"login",render:function(e){return n.a.createElement(M,e)}}),n.a.createElement(d.a,{exact:!0,path:"/registration",key:"registration",render:function(e){return n.a.createElement(P,e)}}),n.a.createElement(d.a,{exact:!0,path:"/admin",key:"registration",render:function(e){return n.a.createElement(J,e)}}),n.a.createElement(d.a,{exact:!0,path:"/admin/add",key:"add",render:function(e){return n.a.createElement(q,e)}}),n.a.createElement(d.a,{exact:!0,path:"/admin/:id",key:"edit",render:function(e){return n.a.createElement($,e)}}),n.a.createElement(d.a,{exact:!0,path:"/reports",key:"reports",render:function(e){return n.a.createElement(X,e)}}))))}}]),a}(r.Component);a(277);o.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(ee,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[114,1,2]]]);
//# sourceMappingURL=main.721e17b4.chunk.js.map